<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Track Your Order</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="order-tracking/style.css">

</head>

<body>
    <!-- Header -->
    <header>
        <div class="header-container">
            <div class="logo">
                <i class="fas fa-box-open"></i>
                <span>TrackOrder</span>
            </div>
            <nav>
                <ul class="nav-links">
                    <li><a href="#" onclick="history.back(); return false;">Home</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <section id="order-tracking-section" class="order-tracking-wrapper">
            <div class="tracking-container">
                <h2 class="tracking-title">Track Your Order</h2>
                <p class="tracking-desc">Enter your Order ID and Billing Email to see your order details and shipping
                    updates.</p>

                <div class="tracking-form-box">
                    <form id="trackForm">
                        <p class="form-row">
                            <label for="orderid">Order ID</label>
                            <input id="orderid" name="orderid" type="text" placeholder="Check your order email."
                                required />
                        </p>
                        <p class="form-row">
                            <label for="order_email">Billing Email</label>
                            <input id="order_email" name="order_email" type="email"
                                placeholder="Email used during checkout." required />
                        </p>
                        <p class="form-row">
                            <button type="submit">Track Order</button>
                        </p>
                    </form>

                    <div id="result" aria-live="polite" style="margin-top:1rem;"></div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer>
        <div class="footer-container">
            <div class="footer-bottom">
                <p>&copy; 2023 TrackOrder. All rights reserved.</p>
            </div>
        </div>
    </footer>







    <script>

        /* Order Tracking Script */
        /*
          Edit these two variables:
          - endpoint: your WP REST endpoint (replace domain)
          - token: the token assigned to this origin in the WP admin
        */
        const endpoint = 'https://sg-product.com/wp-json/ot-public/v1/order'; // <-- change this
        const token = 'i8lsqOKlnXA3DOy4Pr3GX0HIC8oIUoWU'; // <-- change this (from WP admin)



        function sanitizeOrderId(input) {
            // Remove whitespace and common non-order chars like # (2992) etc.
            // Keep letters, numbers, underscores and dashes (useful for order keys).
            return input.trim().replace(/[^\w-]/g, '');
        }

        function renderAddressBox(title, obj) {
            if (!obj) return '';
            const lines = [];
            if (obj.first_name || obj.last_name) lines.push(`${obj.first_name || ''} ${obj.last_name || ''}`.trim());
            if (obj.company) lines.push(obj.company);
            if (obj.address_1) lines.push(obj.address_1);
            if (obj.address_2) lines.push(obj.address_2);
            let cityLine = '';
            if (obj.city) cityLine += obj.city;
            if (obj.state) cityLine += (cityLine ? ', ' : '') + obj.state;
            if (obj.postcode) cityLine += (cityLine ? ' ' : '') + obj.postcode;
            if (cityLine) lines.push(cityLine);
            if (obj.country) lines.push(obj.country);
            if (obj.email) lines.push(`<span style="display:inline-block;margin-top:6px;"><a href="mailto:${obj.email}">${obj.email}</a></span>`);

            return `<div class="address-box"><h4>${title}</h4><div class="addr">${lines.join('<br/>')}</div></div>`;
        }




        document.getElementById('trackForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            const rawOrder = document.getElementById('orderid').value || '';
            const orderid = sanitizeOrderId(rawOrder);
            const order_email = document.getElementById('order_email').value.trim();
            const resultDiv = document.getElementById('result');
            if (!orderid || !order_email) {
                resultDiv.innerHTML = '<div class="error">Please enter order id and billing email.</div>';
                return;
            }
            resultDiv.innerHTML = '<em>Searching…</em>';

            try {
                const payload = { order_id: orderid, email: order_email, token: token };
                const res = await fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (res.status === 403) {
                    const body = await res.json().catch(() => ({}));
                    resultDiv.innerHTML = `<div class="error">Access denied. ${body.error || 'Check the token & origin configuration.'}</div>`;
                    return;
                }
                if (res.status === 429) {
                    resultDiv.innerHTML = '<div class="error">Too many requests. Try again later.</div>';
                    return;
                }
                if (!res.ok) {
                    const txt = await res.text();
                    resultDiv.innerHTML = `<div class="error">Server error: ${res.status} ${txt}</div>`;
                    return;
                }

                const data = await res.json();
                if (!data.found) {
                    resultDiv.innerHTML = `<div class="not-found">${data.message || 'Order not found'}</div>`;
                    return;
                }

                // Build HTML: header + totals + items + billing/shipping boxes
                let html = `<div class="order-result">
                <h3>Order #${data.order_id} — status: ${data.status}</h3>
                <p>Total: ${data.totals ? data.totals.total : ''} — Date: ${data.date_created || '—'}</p>
                <div class="order-items">`;

                for (const it of data.items) {
                    html += `<div class="hz-order-item">
                    <div class="hz-item-thumb">${it.product_image ? `<img src="${it.product_image}" alt="" />` : ''}</div>
                    <div class="hz-item-name-wrap">
                    <div class="hz-item-name">${it.name}</div>
                    <div class="hz-item-meta">Quantity: ${it.quantity} — Subtotal: ${it.subtotal}</div>
                    ${it.meta ? `<div class="hz-item-meta-small">${it.meta}</div>` : ''}
                    </div>
                </div>`;
                }
                html += `</div>`; // .order-items

                // totals summary
                html += `<div class="order-totals" style="margin-top:12px;">
                <table class="totals-table">
                    <tr><td>Subtotal:</td><td>${data.totals ? data.totals.subtotal : ''}</td></tr>
                    <tr><td>Shipping:</td><td>${data.totals ? data.totals.shipping_total : ''}</td></tr>
                    <tr><td><strong>Total:</strong></td><td><strong>${data.totals ? data.totals.total : ''}</strong></td></tr>
                    <tr><td>Payment method:</td><td>${data.payment_method || ''}</td></tr>
                </table>
                </div>`;

                // billing & shipping addresses
                html += `<div class="addr-section" style="display:flex;gap:20px;margin-top:20px;">
                ${renderAddressBox('Billing address', data.billing)}
                ${renderAddressBox('Shipping address', data.shipping)}
                </div>`;

                html += `</div>`; // order-result

                resultDiv.innerHTML = html;

            } catch (err) {
                console.error(err);
                resultDiv.innerHTML = '<div class="error">Network error. Try again later.</div>';
            }
        });
    </script>








</body>

</html>